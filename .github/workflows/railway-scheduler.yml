name: Railway Bot Scheduler

on:
  schedule:
    - cron: "0 8 * * *"   # Start bot at 08:00 UTC
    - cron: "0 0 * * *"   # Stop bot at 00:00 UTC

jobs:
  scheduler:
    runs-on: ubuntu-latest
    steps:
      - name: Start or Stop Railway Service
        run: |
          if [ "${{ github.event.schedule }}" == "0 8 * * *" ]; then
            echo "Starting Railway service..."
            curl -X POST https://backboard.railway.app/graphql/v2 \
              -H "Authorization: Bearer $RAILWAY_API_TOKEN" \
              -H "Content-Type: application/json" \
              -d '{"query":"mutation { serviceInstanceStart(serviceId: \"'$SERVICE_ID'\") { id } }"}'
          else
            echo "Stopping Railway service..."
            curl -X POST https://backboard.railway.app/graphql/v2 \
              -H "Authorization: Bearer $RAILWAY_API_TOKEN" \
              -H "Content-Type: application/json" \
              -d '{"query":"mutation { serviceInstanceStop(serviceId: \"'$SERVICE_ID'\") { id } }"}'
          fi
        env:
          RAILWAY_API_TOKEN: ${{ secrets.RAILWAY_API_TOKEN }}
          SERVICE_ID: ${{ secrets.RAILWAY_SERVICE_ID }}
